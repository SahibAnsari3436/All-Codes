<?php
// Get today's date in the correct format
$today = date('Ymd');

// Query for upcoming events
$upcoming_args = array(
    'post_type' => 'event',
    'posts_per_page' => -1,
    'meta_key' => 'event_date',
    'orderby' => 'meta_value',
    'order' => 'DESC',
    'meta_query' => array(
        array(
            'key' => 'event_date',
            'value' => $today,
            'compare' => '>=',
            'type' => 'DATE'
        )
    )
);

$upcoming_query = new WP_Query($upcoming_args);

// Query for past events
$past_args = array(
    'post_type' => 'event',
    'posts_per_page' => -1,
    'meta_key' => 'event_date',
    'orderby' => 'meta_value',
    'order' => 'DESC',
    'meta_query' => array(
        array(
            'key' => 'event_date',
            'value' => $today,
            'compare' => '<',
            'type' => 'DATE'
        )
    )
);

$past_query = new WP_Query($past_args);
?>

<div class="events-container">
    <!-- Upcoming Events -->
    <h2 style="text-align: center;">Upcoming Events</h2>
    <?php if ($upcoming_query->have_posts()) : ?>
        <div class="events-grid">
            <?php while ($upcoming_query->have_posts()) : $upcoming_query->the_post(); ?>
                <div class="event-item">
                    <div class="event-image">
                        <?php 
                        $image = get_field('event_image');
                        if ($image) : ?>
                            <img src="<?php echo esc_url($image['url']); ?>" alt="<?php echo esc_attr(get_the_title()); ?>">
                        <?php endif; ?>
                    </div>
                    <div class="event-content">
                        <h3><?php the_title(); ?></h3>
                        <p><?php the_field('event_description'); ?></p>
                        
                       <!--- <a href="<?php the_field('button_url'); ?>" class="btn" target="_blank">Get Tickets</a> <----->
                    </div>
                </div>
            <?php endwhile; ?>
        </div>
    <?php else : ?>
        <p style="text-align: center;"><?php esc_html_e('No upcoming events found.', 'text-domain'); ?></p>
    <?php endif; ?>
    <?php wp_reset_postdata(); ?>

    <!-- Divider -->
    <hr style="margin: 50px 0;">

    <!-- Past Events -->
    <h2 style="text-align: center;">Past Events</h2>
    <?php if ($past_query->have_posts()) : ?>
        <div class="events-grid">
            <?php while ($past_query->have_posts()) : $past_query->the_post(); ?>
                <div class="event-item">
                    <div class="event-image">
                        <?php 
                        $image = get_field('event_image');
                        if ($image) : ?>
                            <img src="<?php echo esc_url($image['url']); ?>" alt="<?php echo esc_attr(get_the_title()); ?>">
                        <?php endif; ?>
                    </div>
                    <div class="event-content">
                        <h3><?php the_title(); ?></h3>
                        <p><?php the_field('event_description'); ?></p>
                        
                        <a href="<?php the_field('button_url'); ?>" class="btn" target="_blank">Get Tickets</a>
                    </div>
                </div>
            <?php endwhile; ?>
        </div>
    <?php else : ?>
        <p style="text-align: center;"><?php esc_html_e('No past events found.', 'text-domain'); ?></p>
    <?php endif; ?>
    <?php wp_reset_postdata(); ?>
</div>